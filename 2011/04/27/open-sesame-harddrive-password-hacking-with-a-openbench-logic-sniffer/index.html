<!DOCTYPE html><html><head><meta charset="utf8"><meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/css/vendor.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Maven+Pro|Muli|Play|Quattrocento+Sans|Quicksand|Ropa+Sans|Source+Code+Pro|Ubuntu"><meta name="author" content="John Doe"><meta name="description" content="shackspace = der hackerspace in stuttgart &amp;raquo; Werkstatt, Treffpunkt, Vereinsheim für Nerds &amp;amp; freundliche Digitalkultur"><title>Open Sesame: Harddrive Password Hacking with a OpenBench Logic Sniffer  &mdash;&nbsp;shackspace</title></head><body><nav class="primary"><a class="logo" href="/"><img class="logo" src="/img/logo-white-bg-no-tagline.svg" alt="shackspace"></a><div class="links"><a href="#">Announcements</a><a href="/posts">Events</a><a href="#">Projects</a><a href="https://wiki.shackspace.de">Wiki</a><a href="#">Location</a></div></nav><article class="post"><h2 class="post__title">Open Sesame: Harddrive Password Hacking with a OpenBench Logic Sniffer </h2><div class="post__body"><p><a href="https://blog.shackspace.de/wp-content/uploads/2011/04/DSC_2881.jpg" target="_blank" rel="external"><img src="https://blog.shackspace.de/wp-content/uploads/2011/04/DSC_2881-150x150.jpg" alt="" title="Laptop harddrive wired up for bus sniffing"></a>shackspace’s @<a href="https://twitter.com/dop3j0e" target="_blank" rel="external">dop3j0e</a> had a big problem.  A password problem.  Quite a while ago he set up a password for his Thinkpad’s harddrive and chose to unlock his drive using the built-in fingerprint scanner.  Years passed, thumbs were drawn over the scanner countless times, passwords were changed frequently.  But not all passwords were changed.  That one password for his harddrive never did change and over time he simply forgot what the actual password was.</p>
<p>The thumb print scanner kept working.  However, to change or disable the password you have to enter it by keyboard in the BIOS since in this case it does not accept the thumb print scanner as input.<br>This poses a real problem.  How do you access the disk if your fingerprint scanner dies?  Or what if the laptop dies and you have to unlock the drive from a different machine that doesn’t have the password stored in the fingerprint scanner?</p>
<p><a id="more"></a>There’s various approaches to go about this issue.<br>One idea was  to reverse engineer the BIOS to find out where the actual password is stored.  This turned out to be especially nasty business and while a lot of insight was gained into how (ugly) a BIOS looks from the inside, no password was recovered.<br>Another idea which does not work was exchanging the control board of the harddrive with that of a similar model. Turns out the harddrive password is stored on the platter, not the controller.<br>You could of course use a logic sniffer (costs multiple kilo-Euros) and sniff the IDE bus for the password being transmitted.  Not really an option either… or is it?</p>
<h3 id="Open-Source-Hardware-to-the-Rescue"><a href="#Open-Source-Hardware-to-the-Rescue" class="headerlink" title="Open Source Hardware to the Rescue"></a>Open Source Hardware to the Rescue</h3><p><a href="https://blog.shackspace.de/wp-content/uploads/2011/04/101721653.jpg" target="_blank" rel="external"><img src="https://blog.shackspace.de/wp-content/uploads/2011/04/101721653-150x150.jpg" alt="" title="OpenBench Logic Sniffer"></a>Thanks to the open source hardware movement, you can have a logic sniffer for just $50!  The <a href="http://www.seeedstudio.com/depot/open-workbench-logic-sniffer-p-612.html?cPath=174" target="_blank" rel="external">OpenBench Logic Sniffer</a> is exactly what you want and @<a href="https://twitter.com/hdznrrd" target="_blank" rel="external">hdznrrd</a> at shackspace just happened to receive his first batch pre-order at the exact time @dop3j0e was about to fall into despair.</p>
<p>The OBLS comes with 16 buffered (3.3 or 5V) pins and another 16 unbuffered (3.3V only) pins.  The <a href="https://secure.wikimedia.org/wikipedia/en/wiki/Parallel_ATA" target="_blank" rel="external">IDE bus</a> happens to be a 5V bus, ruling out half of the capture pins, and to sniff everything you’d need 40 pins.</p>
<p>It turns out it’s good enough to just sniff the data pins and nothing else (details below).  And yes, the IDE bus has exactly 16 data pins :)</p>
<h3 id="Sniffing-the-IDE-bus-for-the-Password-Transfer"><a href="#Sniffing-the-IDE-bus-for-the-Password-Transfer" class="headerlink" title="Sniffing the IDE bus for the Password Transfer"></a>Sniffing the IDE bus for the Password Transfer</h3><p><a href="https://blog.shackspace.de/wp-content/uploads/2011/04/DSC_2883.jpg" target="_blank" rel="external"><img src="https://blog.shackspace.de/wp-content/uploads/2011/04/DSC_2883-150x150.jpg" alt="" title="In-line sniffing setup"></a>Next it was time to hook up the harddrive to the sniffer.  What makes this slightly complicated is that you have to sniff the bus while the harddrive is mounted inside the laptop.<br>To do this individual wires were connected to each of the 16 data pins.  Since the drive bay wasn’t large enough to accommodate the wiring, the laptop had to be partially disassembled.</p>
<p>The OBLS is compatible with the <a href="http://www.sump.org/projects/analyzer/client/" target="_blank" rel="external">SUMP Logic Analyzer GUI</a> which was used to control the analyzer and set up triggering.</p>
<p>The sniffer was set up to start logging data as soon as the 0xF2 unlock command is seen on the data bus which is then followed by the plain text password, which is exactly what you need to unlock the drive yourself. A from-memory reconstruction of the trigger settings can be found <a href="https://blog.shackspace.de/gallery/index.php/Projekte/Festplattenpasswort-sniffen/sump-trigger-settings" target="_blank" rel="external">here</a>.</p>
<p>Below screenshot shows the SUMP GUI displaying the results of a successful password sniffing run (note the ‘f2’ command).  <em>Note: the Prezi presentation linked below contains an <strong>annotated</strong> full length  screen capture of the sniffed password.</em></p>
<p><a href="https://blog.shackspace.de/wp-content/uploads/2011/04/sump_trigger.png" target="_blank" rel="external"><img src="https://blog.shackspace.de/wp-content/uploads/2011/04/sump_trigger-300x115.png" alt="" title="Trigger and 0xf2 command in SUMP"></a></p>
<h3 id="Unlocking-the-Drive"><a href="#Unlocking-the-Drive" class="headerlink" title="Unlocking the Drive"></a>Unlocking the Drive</h3><p>Now the drive can be unlocked using the handy hdparm tool:</p>
<pre># hdparm --user-master u --security-unlock \
  $(echo -ne "\036\023\042\046\006\002\004\013")</pre>
Once unlocked, the password can be disabled entirely:
<pre># hdparm --user-master u --security-disable \
  $(echo -ne "\036\023\042\046\006\002\004\013")</pre>

<h3 id="Metafoo"><a href="#Metafoo" class="headerlink" title="Metafoo"></a>Metafoo</h3><ul>
<li>@dop3j0e’s presentation “<a href="http://prezi.com/k1xduox30soj/open-sesame/" target="_blank" rel="external">Open Sesame</a>“ on how he hacked his harddrive</li>
<li><a href="http://www.shackspace.de/gallery/index.php/Projekte/Festplattenpasswort-sniffen" target="_blank" rel="external">Photo documentation of the project</a><br><strong>Update #1</strong>: Exchanged the SUMP screenshot with one that actually shows the 0xf2 command.<strong><br>Update #2</strong>: Added more info why sniffing of the password was necessary.<strong><br>Update #3</strong>: Added link to the trigger settings.<div id="_mcePaste" style="position: absolute; left: -10000px; top: 495px; width: 1px; height: 1px; overflow: hidden;"><a href="http://www.shackspace.de/gallery/index.php/Projekte/Festplattenpasswort-sniffen" target="_blank" rel="external">http://www.shackspace.de/gallery/index.php/Projekte/Festplattenpasswort-sniffen</a></div></li>
</ul>
</div></article></body></html>